<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>付箋ペタペタ</title>
    <link rel="stylesheet" href="css/fusenpeta.css" />
  </head>

  <body>
    <header>
      <h1>付箋ペタペタ</h1>
    </header>

    <main>
      <div id="leaves">登録数：0枚</div>
      <div id="input_area">
        <div id="fusen_area" class="area">
          <div class="fusen">付箋を貼っていく</div>
        </div>

        <div id="form_top">
          <div>
            <input type="date" id="date" />
          </div>
          <div id="save">登録</div>
        </div>
        <p>タイトル</p>
        <input type="text" id="title" value="無題" />

        <p>本文</p>
        <textarea id="text_area" cols="280">ここに記入</textarea>

        <p>背景色</p>
        <div class="color_select">
          <div>
            <select id="back_color">
              <option value="#fff7c9">黄色</option>
              <option value="#c0e4f2">水色</option>
              <option value="#d2e7bf">緑色</option>
              <option value="#f7c4d4">ピンク</option>
            </select>
          </div>
          <div class="sample_color">
            <div>背景色のサンプル</div>
          </div>
        </div>
      </div>

      <ul>
        <li id="rewrite">上書き保存</li>
        <li id="clear">1件削除</li>
        <li id="all_clear">全消し</li>
      </ul>
    </main>

    <footer></footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
      // 付箋データを格納する配列
      let fusendate = [];

      // 付箋データをLocalStorageに保存
      function savefusendate() {
        localStorage.setItem("all_fusens", JSON.stringify(fusendate));
      }

      // LocalStorageから付箋データをロード
      function loadfusendate() {
        const json = localStorage.getItem("all_fusens");
        if (json) {
          fusendate = JSON.parse(json);
        } else {
          fusendate = [];
        }
      }

      function makeFusen() {
        const fusenArea = $("#fusen_area");
        fusenArea.empty(); // 古い付箋を全てクリアしてから再描画

        fusendate.forEach((data) => {
          // 描画用のHTMLを生成
          const fusenHtml = `
                <div class="fusen" data-id="${
                  data.id
                }" style="background-color: ${data.color};">
                <div class="fusentop">
                  <div>
                    <p class="fusen_date">${data.date}</p>
                  
                  </div>
                  <div>
                    <p class="fusen_title">${data.title}</p>
                  
                  </div>
                  </div>
                    <p class="fusen_text">${data.text}</p>
                </div>
            `;
          fusenArea.append(fusenHtml);
        });
      }

      // ページロード時

      $(document).ready(function () {
        // 1. 今日の日付設定
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = ("0" + (today.getMonth() + 1)).slice(-2);
        const dd = ("0" + today.getDate()).slice(-2);
        const formattedDate = yyyy + "-" + mm + "-" + dd;
        $("#date").val(formattedDate);

        // 2. カラーセレクタの動作設定
        const selectElement = document.getElementById("back_color");
        const sampleElement = document.querySelector(".sample_color");
        const updateSampleColor = () => {
          sampleElement.style.backgroundColor = selectElement.value;
        };
        selectElement.addEventListener("change", updateSampleColor);
        updateSampleColor(); // 初期色を設定

        // 3. データロードと画面表示
        loadfusendate();
        makeFusen();
      });

      // 新しい付箋を保存
      $("#save").on("click", function () {
        // フォームからデータを取得
        const newFusen = {
          id: Date.now(),
          date: $("#date").val(),
          title: $("#title").val(),
          text: $("#text_area").val(),
          color: $("#back_color").val(),
        };

        console.log(fusendate);

        // データ配列に追加
        fusendate.push(newFusen);

        // LocalStorageに保存
        savefusendate();

        // 画面に再描画
        makeFusen();

        console.log(fusendate.length);

        $("#leaves").text("登録数：" + fusendate.length + "枚");

        // 入力フォームをデフォルトに戻す
        $("#title").val("無題");
        $("#text_area").val("ここに記入");
      });

      // 全ての付箋を削除
      $("#all_clear").on("click", function () {
        if (confirm("全ての付箋を削除しますか？")) {
          fusendate = []; // データ配列を空にする
          savefusendate(); // LocalStorageを空で保存
          makeFusen(); // 画面も消す
        $("#leaves").text("登録数：0枚");

        }
      });
    </script>
  </body>
</html>
